def get_bot_response(user_input, user_name):
    global chat_history
    # Normalize user input
    normalized_input = normalize_text(user_input)
    
    # Check for greeting patterns
    if greeting_patterns.search(normalized_input):
        initial_greeting = (f"ğŸ˜ŠHola!!, con Â¿CuÃ¡l opciÃ³n puedo ayudarte? "
                            "<button class='option-button' onclick=\"sendMessage('Tengo una consulta')\">Consulta</button>"
                            "<button class='option-button' onclick=\"sendMessage('Tengo un dilema')\">Dilema</button>"
                            "<button class='option-button' onclick=\"sendMessage('Con quienes me puedo contactar')\">Contactos</button>")
        chat_history.append(('Bot', initial_greeting))
        return initial_greeting
    
    # Check for farewell patterns
    if farewell_patterns.search(normalized_input):
        farewell_message = "Fue un gusto servirte!!ğŸ‘, Â¡que tengas un buen dÃ­a! Si necesitas mÃ¡s ayuda, estarÃ© aquÃ­ para asistirte.ğŸ‘¨â€ğŸ’»"
        chat_history.append(('Bot', farewell_message))
        return farewell_message
    
    # Check for yes/no responses
    if normalized_input == 'si':
        return get_initial_greeting(user_name)
    if normalized_input == 'no':
        return get_farewell_message()
    
    for intent in intents['intents']:
        if normalized_input == normalize_text(intent['tag']):
            response = intent.get('responses', ["Sorry, I don't understand."])[0]
            options = intent.get('options', [])
            if options:
                response += "<br><br>ğŸ‘¨â€ğŸ«EncontrÃ© estas opciones: " + "".join(
                    f'<button class="option-button" onclick="sendMessage(\'{opt}\')">{opt}</button>' for opt in options)
            else:
                response += "<br><br> Â¿Puedo ayudarte con algo mÃ¡s? " \
                            "<br><button class='option-button green' onclick=\"sendMessage('SI')\">SI</button> " \
                            "<button class='option-button green' onclick=\"sendMessage('NO')\">NO</button>"
            chat_history.append(('Bot', response))
            return response
    
    return "Lo siento, No te entiendo. ğŸ˜…"
